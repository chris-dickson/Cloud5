!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.WordCloudCanvas=t()}}(function(){return function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var f=i[s]={exports:{}};e[s][0].call(f.exports,function(t){var i=e[s][1][t];return n(i?i:t)},f,f.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e){function i(t){var e=new Array(t||0),r=t;if(arguments.length>1)for(var n=Array.prototype.slice.call(arguments,1);r--;)e[t-1-r]=i.apply(this,n);return e}var r=t("./util"),n=t("./textbitmap"),o=function(t){this._canvas=null,this._words=null,this._bitmap=null,this._textBitmapper=null,r.extend(this,t)};o.prototype=r.extend(o.prototype,{_initialize:function(){var t={};this.debug&&(t.debug=!0),this._textBitmapper=new n(t),this._bitmap=i(this._canvas.width,this._canvas.height);for(var e=0;e<this._canvas.width;e++)for(var r=0;r<this._canvas.height;r++)this._bitmap[e][r]=!1},canvas:function(t){return t?(this._canvas=t,this):this._canvas},words:function(t){return t?(this._words=t,this):this._words},bitmap:function(){return this._textBitmapper.toCanvas(this._bitmap)},onWordOver:function(t){return this._onWordOver=t,this},layout:function(){function t(t,e,r){t.fillStyle="white",t.fillRect(0,0,e,r),Object.keys(i).forEach(function(e){var r=i[e];void 0!==r.x&&-1!==r.x&&void 0!==r.y&&-1!==r.y&&(t.font=r.fontSize+"px "+r.fontFamily,t.fillStyle="red",t.strokeStyle="green",t.fillText(e,r.x,r.y),t.strokeRect(r.x+r.bb.offsetX,r.y+r.bb.offsetY,r.bb.width,r.bb.height))})}function e(t){var e=t.offsetX,i=t.offsetY,r=n._bitmap[e][i];r&&n._onWordOver&&n._onWordOver(r)}this._initialize();var i={};if(this._words){var n=this,o=Number.MAX_VALUE,s=0;Object.keys(this._words).forEach(function(t){o=Math.min(n._words[t],o),s=Math.max(n._words[t],s)});var a=10,h=200;Object.keys(this._words).forEach(function(t){var e=(n._words[t]-o)/(s-o),f=r.step(a,h,e),u=n._textBitmapper.create(t,f,"Calibri");i[t]=u})}var f=Object.keys(this._words).sort(function(t,e){return n._words[e]-n._words[t]});return f.forEach(function(e){var r=!1,o=100;for(this.debug&&t(n._canvas.getContext("2d"),n._canvas.width,n._canvas.height);!r&&o>0;){var s=Math.floor(Math.random()*n._canvas.width),a=Math.floor(Math.random()*n._canvas.height);if(i[e].x=s,i[e].y=a,n._textBitmapper.fits(i[e],n._bitmap)){r=!0;for(var h=i[e].bitmap.length,f=i[e].bitmap[0].length,u=0;h>u;u++)for(var l=0;f>l;l++){var c=i[e].x+i[e].bb.offsetX+u,d=i[e].y+i[e].bb.offsetY+l;i[e].bitmap[u][l]&&(n._bitmap[c][d]=e)}}else o--}r||(i[e].x=-1,i[e].y=-1)}),this._canvas.onmousemove=e,i}}),e.exports=o},{"./textbitmap":3,"./util":4}],2:[function(t,e,i){var r=t("./util"),n=t("./layout"),o=function(t){this._words={},this._stopWords={},this._canvas=null,this._width=null,this._height=null,this._backgroundFill=null,this._onWordOver=null,this._layout=null,r.extend(this,t)};o.prototype=r.extend(o.prototype,{canvas:function(t){return t?(this._canvas=t,this._width=t.width,this._height=t.height,this):this._canvas},width:function(t){return t?(this._canvas&&(this._canvas.width=t,this._width=t),this):this.width},height:function(t){return t?(this._canvas&&(this._canvas.height=t,this._height=t),this):this._height},text:function(t){var e=t.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"");e=e.replace(/\[[0-9]*\]/g,""),e=e.replace(/[\t+\[\]]/g,"");var i=e.split(" ");return this.words(i),this},stop:function(t){if(t){var e=this;return t.forEach(function(t){e._stopWords[t.trim().toLowerCase()]=!0}),this}return this._stopWords},background:function(t){return t?(this._backgroundFill=t,this):this._backgroundFill},words:function(t){if(t){var e=this;return t.forEach(function(t){var i=t.trim().toLowerCase();if(!e._stopWords[i]&&""!==i){var r=e._words[i];r||(r=0),r++,e._words[i]=r}}),this}return this._words},onWordOver:function(t){return this._onWordOver=t,this},generate:function(){var t={};this.debug&&(t.debug=!0);var e=new n(t).canvas(this._canvas).words(this._words).onWordOver(this._onWordOver),i=e.layout(),r=this._canvas.getContext("2d");this._backgroundFill&&(r.fillStyle=this._backgroundFill,r.fillRect(0,0,this._width,this._height));var o=this;return Object.keys(i).forEach(function(t){var e=i[t];-1!==e.x&&-1!==e.y&&(r.font=e.fontSize+"px "+e.fontFamily,r.fillStyle="red",r.strokeStyle="green",r.fillText(t,e.x,e.y),o.debug&&r.strokeRect(e.x+e.bb.offsetX,e.y+e.bb.offsetY,e.bb.width,e.bb.height))}),this}}),i.Extend=r.extend,i.WordCloud=o},{"./layout":1,"./util":4}],3:[function(t,e){function i(t){var e=new Array(t||0),r=t;if(arguments.length>1)for(var n=Array.prototype.slice.call(arguments,1);r--;)e[t-1-r]=i.apply(this,n);return e}var r=t("./util"),n=function(t){this._canvas=null,this._context=null,r.extend(this,t),this._canvas=document.createElement("canvas"),this._canvas.width=640,this._canvas.height=480,this._context=this._canvas.getContext("2d"),this.debug&&document.body.appendChild(this._canvas),this._bitmap=i(this._canvas.width,this._canvas.height);for(var e=0;e<this._canvas.width;e++)for(var n=0;n<this._canvas.height;n++)this._bitmap[e][n]=!1};n.prototype=r.extend(n.prototype,{create:function(t,e,r){var n=this._context;n.fillStyle="black",n.fillRect(0,0,this._canvas.width,this._canvas.height);var o=5,s=Math.floor(this._canvas.height/2);n.fillStyle="white",n.font=e+"px "+r,n.fillText(t,o,s);for(var a=n.measureText(t).width,h=o,f=s-e-2,u=h+a+o,l=f+e+.5*e,c=n.getImageData(h,f,u-h,l-f),d=i(c.width,c.height),v=0,_=0,p=0;p<c.data.length;p+=4)d[v][_]=0!==c.data[p],v++,v===c.width&&(v=0,_++);var b=Number.MAX_VALUE,g=Number.MAX_VALUE,w=-Number.MAX_VALUE,y=-Number.MAX_VALUE;for(v=0;v<d.length;v++)for(_=0;_<d[v].length;_++)d[v][_]&&(b=Math.min(b,v),g=Math.min(g,_),w=Math.max(w,v),y=Math.max(y,_));var m=i(w-b,y-g);for(v=0;w-b>v;v++)for(_=0;y-g>_;_++)m[v][_]=d[b+v][g+_];this.debug&&(n.strokeStyle="yellow",n.strokeRect(h,f,u-h,l-f)),n.strokeStyle="red",n.strokeRect(o,s,this._canvas.width,this._canvas.height);var x=w-b,k=y-g,M=-(o-(h+b)),E=-(s-(f+g));this.debug&&(n.strokeStyle="green",n.strokeRect(o+M,s+E,x,k));var O={bb:{offsetX:M,offsetY:E,width:x,height:k},bitmap:m,fontSize:e,fontFamily:r};return O},fits:function(t,e){for(var i=t.x+t.bb.offsetX,r=t.y+t.bb.offsetY,n=e.length,o=e[0].length,s=0>i||0>r,a=!1,h=s||a,f=0;f<t.bb.width&&!h;f++)for(var u=i+f,l=0;l<t.bb.height&&!h;l++){var c=r+l;u>=n||c>=o?s=!0:e[u][c]&&(a=!0),h=s||a}return!h}}),e.exports=n},{"./util":4}],4:[function(t,e){var i={extend:function(t){var e,i,r;for(i=1;i<arguments.length;i++){r=arguments[i];for(e in r)r.hasOwnProperty(e)&&(t[e]=r[e])}return t},lerp:function(t,e,i){return t+i*(e-t)},step:function(t,e,i){return Math.round(this.lerp(t,e,i))}};e.exports=i},{}]},{},[2])(2)});