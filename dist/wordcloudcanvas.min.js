!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.WordCloudCanvas=t()}}(function(){return function t(i,e,n){function r(s,h){if(!e[s]){if(!i[s]){var o="function"==typeof require&&require;if(!h&&o)return o(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=e[s]={exports:{}};i[s][0].call(u.exports,function(t){var e=i[s][1][t];return r(e?e:t)},u,u.exports,t,i,e,n)}return e[s].exports}for(var a="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,i){function e(t){var i=new Array(t||0),n=t;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);n--;)i[t-1-n]=e.apply(this,r);return i}var n=t("./util"),r=t("./textbitmap"),a=function(t){this._canvas=null,this._words=null,this._bitmap=null,this._textBitmapper=null,n.extend(this,t)};a.prototype=n.extend(a.prototype,{_initialize:function(){this._textBitmapper=new r,this._bitmap=e(this._canvas.width,this._canvas.height);for(var t=0;t<this._canvas.width;t++)for(var i=0;i<this._canvas.height;i++)this._bitmap[t][i]=!1},canvas:function(t){return t?(this._canvas=t,this):this._canvas},words:function(t){return t?(this._words=t,this):this._words},bitmap:function(){return this._textBitmapper.toCanvas(this._bitmap)},layout:function(){this._initialize();var t={};if(this._words){var i=this,e=Number.MAX_VALUE,r=0;Object.keys(this._words).forEach(function(t){e=Math.min(i._words[t],e),r=Math.max(i._words[t],r)});var a=20,s=100;Object.keys(this._words).forEach(function(h){var o=(i._words[h]-e)/(r-e),u=n.step(a,s,o),c=i._textBitmapper.create(h,u,"Calibri");t[h]=c})}var h=Object.keys(this._words).sort(function(t,e){return i._words[e]-i._words[t]});return h.forEach(function(e){for(var n=!1,r=30;!n&&r>0;){var a=Math.floor(Math.random()*i._canvas.width),s=Math.floor(Math.random()*i._canvas.height);if(t[e].x=a,t[e].y=s,i._textBitmapper.intersects(t[e],i._bitmap))r--;else{for(n=!0,a=t[e].x;a<t[e].x+t[e].width;a++)for(s=t[e].y;s<t[e].y+t[e].height;s++)i._bitmap[a][s]=!0;t[e].y+=t[e].height}}n||(t[e].x=-1,t[e].y=-1)}),t}}),i.exports=a},{"./textbitmap":3,"./util":4}],2:[function(t,i,e){var n=t("./util"),r=t("./layout"),a=function(t){this._words={},this._stopWords={},this._canvas=null,this._width=null,this._height=null,this._backgroundFill=null,this._layout=null,n.extend(this,t)};a.prototype=n.extend(a.prototype,{canvas:function(t){return t?(this._canvas=t,this._width=t.width,this._height=t.height,this):this._canvas},width:function(t){return t?(this._canvas&&(this._canvas.width=t,this._width=t),this):this.width},height:function(t){return t?(this._canvas&&(this._canvas.height=t,this._height=t),this):this._height},text:function(t){var i=t.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"");i=i.replace(/\[[0-9]*\]/g,""),i=i.replace(/[\t+\[\]]/g,"");var e=i.split(" ");return this.words(e),this},stop:function(t){if(t){var i=this;return t.forEach(function(t){i._stopWords[t.trim().toLowerCase()]=!0}),this}return this._stopWords},background:function(t){return t?(this._backgroundFill=t,this):this._backgroundFill},words:function(t){if(t){var i=this;return t.forEach(function(t){var e=t.trim().toLowerCase();if(!i._stopWords[e]&&""!==e){var n=i._words[e];n||(n=0),n++,i._words[e]=n}}),this}return this._words},generate:function(){var t=(new r).canvas(this._canvas).words(this._words),i=t.layout(),e=this._canvas.getContext("2d");return this._backgroundFill&&(e.fillStyle=this._backgroundFill,e.fillRect(0,0,this._width,this._height)),Object.keys(i).forEach(function(t){var n=i[t];-1!==n.x&&-1!==n.y&&(e.font=n.fontSize+"px "+n.fontFamily,e.fillStyle="red",e.strokeStyle="green",e.fillText(t,n.x,n.y))}),this}}),e.Extend=n.extend,e.WordCloud=a},{"./layout":1,"./util":4}],3:[function(t,i){function e(t){var i=new Array(t||0),n=t;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);n--;)i[t-1-n]=e.apply(this,r);return i}var n=t("./util"),r=function(t){this._canvas=null,this._context=null,n.extend(this,t),this._canvas=document.createElement("canvas"),this._canvas.width=640,this._canvas.height=480,this._context=this._canvas.getContext("2d"),document.body.appendChild(this._canvas),this._bitmap=e(this._canvas.width,this._canvas.height);for(var i=0;i<this._canvas.width;i++)for(var r=0;r<this._canvas.height;r++)this._bitmap[i][r]=!1};r.prototype=n.extend(r.prototype,{create:function(t,i,n){var r=this._context;r.fillStyle="black",r.fillRect(0,0,this._canvas.width,this._canvas.height);var a=5,s=Math.floor(this._canvas.height/2);r.fillStyle="white",r.font=i+"px "+n,r.fillText(t,a,s);for(var h=r.measureText(t).width,o=a,u=this._canvas.height/2-i-2,c=o+h+a,f=u+i+.5*i,l=r.getImageData(o,u,c-o,f-u),d=e(l.width,l.height),_=0,v=0,p=0;p<l.data.length;p+=4)d[_][v]=0!==l.data[p],_++,_===l.width&&(_=0,v++);var g=Number.MAX_VALUE,w=Number.MAX_VALUE,m=-Number.MAX_VALUE,y=-Number.MAX_VALUE;for(_=0;_<d.length;_++)for(v=0;v<d[_].length;v++)d[_][v]&&(g=Math.min(g,_),w=Math.min(w,v),m=Math.max(m,_),y=Math.max(y,v));var x=e(m-g,y-w);for(_=0;m-g>_;_++)for(v=0;y-w>v;v++)x[_][v]=d[g+_][w+v];var b={width:m-g,height:y-w,bitmap:x,fontSize:i,fontFamily:n};return b},intersects:function(t,i){if(t.x+t.width>i.length)return!0;if(t.y+t.height>i[0].length)return!0;for(var e=!0,n=0;n<t.bitmap.length&&e;n++)for(var r=0;r<t.bitmap[n].length&&e;r++){var a=t.x+n,s=t.y+r,h=t.bitmap[n][r],o=i[a][s];e&=!(h&&o)}return!e},toCanvas:function(t){var i=document.createElement("canvas"),e=i.getContext("2d"),n=t.length,r=t[0].length;i.width=n,i.height=r;for(var a=e.createImageData(i.width,i.height),s=[],h=0;n>h;h++)for(var o=0;r>o;o++){var u=t[h][o]?[255,255,255,1]:[0,0,0,1];s.concat(u)}return a.data=s,e.putImageData(a,0,0),i}}),i.exports=r},{"./util":4}],4:[function(t,i){var e={extend:function(t){var i,e,n;for(e=1;e<arguments.length;e++){n=arguments[e];for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t},lerp:function(t,i,e){return t+e*(i-t)},step:function(t,i,e){return Math.round(this.lerp(t,i,e))}};i.exports=e},{}]},{},[2])(2)});