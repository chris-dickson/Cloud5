!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.WordCloudCanvas=t()}}(function(){return function t(i,r,e){function n(s,o){if(!r[s]){if(!i[s]){var h="function"==typeof require&&require;if(!o&&h)return h(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var f=r[s]={exports:{}};i[s][0].call(f.exports,function(t){var r=i[s][1][t];return n(r?r:t)},f,f.exports,t,i,r,e)}return r[s].exports}for(var a="function"==typeof require&&require,s=0;s<e.length;s++)n(e[s]);return n}({1:[function(t,i){function r(t){var i=new Array(t||0),e=t;if(arguments.length>1)for(var n=Array.prototype.slice.call(arguments,1);e--;)i[t-1-e]=r.apply(this,n);return i}var e=t("./util"),n=t("./textbitmap"),a=function(t){this._canvas,this._words,this._textBitmapper,e.extend(this,t)};a.prototype=e.extend(a.prototype,{_initialize:function(){this._textBitmapper=new n,this._bitmap=r(this._canvas.width,this._canvas.height);for(var t=0;t<this._canvas.width;t++)for(var i=0;i<this._canvas.height;i++)this._bitmap[t][i]=!1},canvas:function(t){return t?(this._canvas=t,this):this._canvas},words:function(t){return t?(this._words=t,this):this._words},layout:function(){this._initialize();var t={};if(this._words){var i=this,r=Number.MAX_VALUE,n=0;Object.keys(this._words).forEach(function(t){r=Math.min(i._words[t],r),n=Math.max(i._words[t],n)});var a=20,s=100;Object.keys(this._words).forEach(function(o){var h=(i._words[o]-r)/(n-r),f=e.step(a,s,h),c=i._textBitmapper.create(o,f,"Calibri");t[o]=c})}var o=Object.keys(this._words).sort(function(t,r){return i._words[r]-i._words[t]});return o.forEach(function(r){for(var e=!1,n=30;!e&&n>0;){var a=Math.floor(Math.random()*i._canvas.width),s=Math.floor(Math.random()*i._canvas.height);t[r].x=a,t[r].y=s;var o=i._canvas.getContext("2d");if(o.font=t[r].fontSize+"px "+t[r].fontFamily,o.fillStyle="red",o.fillText(r,t[r].x,t[r].y),i._textBitmapper.intersects(t[r],i._bitmap))n--;else{e=!0;for(var a=t[r].x;a<t[r].x+t[r].width;a++)for(var s=t[r].y;s<t[r].y+t[r].height;s++)i._bitmap[a][s]=!0;var h=0;h++}}e||(t[r].x=-1,t[r].y=-1)}),t}}),i.exports=a},{"./textbitmap":3,"./util":4}],2:[function(t,i,r){var e=t("./util"),n=t("./layout"),a=function(t){this._words={},this._stopWords={},this._canvas,this._width,this._height,this._backgroundFill,this._layout,e.extend(this,t)};a.prototype=e.extend(a.prototype,{canvas:function(t){return t?(this._canvas=t,this._width=t.width,this._height=t.height,this):this._canvas},width:function(t){return t?(this._canvas&&(this._canvas.width=t,this._width=t),this):this.width},height:function(t){return t?(this._canvas&&(this._canvas.height=t,this._height=t),this):this._height},text:function(t){var i=t.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"");i=i.replace(/\[[0-9]*\]/g,""),i=i.replace(/[\t+\[\]]/g,"");var r=i.split(" ");return this.words(r),this},stop:function(t){if(t){var i=this;return t.forEach(function(t){i._stopWords[t.trim().toLowerCase()]=!0}),this}return this._stopWords},background:function(t){return t?(this._backgroundFill=t,this):this._backgroundFill},words:function(t){if(t){var i=this;return t.forEach(function(t){var r=t.trim().toLowerCase();if(!i._stopWords[r]&&""!==r){var e=i._words[r];e||(e=0),e++,i._words[r]=e}}),this}return this._words},generate:function(){var t=(new n).canvas(this._canvas).words(this._words),i=t.layout(),r=this._canvas.getContext("2d");return this._backgroundFill&&(r.fillStyle=this._backgroundFill,r.fillRect(0,0,this._width,this._height)),Object.keys(i).forEach(function(t){var e=i[t];-1!==e.x&&-1!==e.y&&(r.font=e.fontSize+"px "+e.fontFamily,r.fillStyle="red",r.fillText(t,e.x,e.y))}),this}}),r.Extend=e.extend,r.WordCloud=a},{"./layout":1,"./util":4}],3:[function(t,i){function r(t){var i=new Array(t||0),e=t;if(arguments.length>1)for(var n=Array.prototype.slice.call(arguments,1);e--;)i[t-1-e]=r.apply(this,n);return i}var e=t("./util"),n=function(t){this._canvas,this._context,e.extend(this,t),this._canvas=document.createElement("canvas"),this._canvas.width=640,this._canvas.height=480,this._context=this._canvas.getContext("2d"),this._bitmap=r(this._canvas.width,this._canvas.height);for(var i=0;i<this._canvas.width;i++)for(var n=0;n<this._canvas.height;n++)this._bitmap[i][n]=!1};n.prototype=e.extend(n.prototype,{create:function(t,i,e){var n=this._context;n.fillStyle="black",n.fillRect(0,0,this._canvas.width,this._canvas.height);var a=5;n.fillStyle="white",n.font=i+"px "+e,n.fillText(t,a,this._canvas.height/2);for(var s=n.measureText(t).width,o=a,h=this._canvas.height/2-i-2,f=o+s+a,c=h+i+.5*i,u=n.getImageData(o,h,f-o,c-h),l=r(u.width,u.height),d=0,_=0,v=0;v<u.data.length;v+=4)l[d][_]=0!==u.data[v],d++,d===u.width&&(d=0,_++);for(var p=Number.MAX_VALUE,w=Number.MAX_VALUE,g=-Number.MAX_VALUE,x=-Number.MAX_VALUE,d=0;d<l.length;d++)for(var _=0;_<l[d].length;_++)l[d][_]&&(p=Math.min(p,d),w=Math.min(w,_),g=Math.max(g,d),x=Math.max(x,_));for(var y=r(g-p,x-w),d=0;g-p>d;d++)for(var _=0;x-w>_;_++)y[d][_]=l[p+d][w+_];var m={width:g-p,height:x-w,bitmap:y,fontSize:i,fontFamily:e};return m},intersects:function(t,i){if(t.x+t.width>i.length)return!0;if(t.y+t.height>i[0].length)return!0;for(var r=!0,e=0;e<t.bitmap.length&&r;e++)for(var n=0;n<t.bitmap[e].length&&r;n++){var a=t.x+e,s=t.y+n,o=t.bitmap[e][n],h=i[a][s];r&=!(o&&h)}return!r}}),i.exports=n},{"./util":4}],4:[function(t,i){var r={extend:function(t){var i,r,e;for(r=1;r<arguments.length;r++){e=arguments[r];for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}return t},lerp:function(t,i,r){return t+r*(i-t)},step:function(t,i,r){return Math.round(this.lerp(t,i,r))}};i.exports=r},{}]},{},[2])(2)});