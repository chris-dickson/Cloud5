!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.WordCloudCanvas=t()}}(function(){return function t(i,e,r){function n(s,h){if(!e[s]){if(!i[s]){var o="function"==typeof require&&require;if(!h&&o)return o(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=e[s]={exports:{}};i[s][0].call(c.exports,function(t){var e=i[s][1][t];return n(e?e:t)},c,c.exports,t,i,e,r)}return e[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,i){function e(t){var i=new Array(t||0),r=t;if(arguments.length>1)for(var n=Array.prototype.slice.call(arguments,1);r--;)i[t-1-r]=e.apply(this,n);return i}var r=t("./util"),n=t("./textbitmap"),a=function(t){this._canvas,this._words,this._bitmap,this._textBitmapper,r.extend(this,t)};a.prototype=r.extend(a.prototype,{_initialize:function(){this._textBitmapper=new n,this._bitmap=e(this._canvas.width,this._canvas.height);for(var t=0;t<this._canvas.width;t++)for(var i=0;i<this._canvas.height;i++)this._bitmap[t][i]=!1},canvas:function(t){return t?(this._canvas=t,this):this._canvas},words:function(t){return t?(this._words=t,this):this._words},bitmap:function(){return this._textBitmapper.toCanvas(this._bitmap)},layout:function(){this._initialize();var t={};if(this._words){var i=this,e=Number.MAX_VALUE,n=0;Object.keys(this._words).forEach(function(t){e=Math.min(i._words[t],e),n=Math.max(i._words[t],n)});var a=20,s=100;Object.keys(this._words).forEach(function(h){var o=(i._words[h]-e)/(n-e),c=r.step(a,s,o),u=i._textBitmapper.create(h,c,"Calibri");t[h]=u})}var h=Object.keys(this._words).sort(function(t,e){return i._words[e]-i._words[t]});return h.forEach(function(e){for(var r=!1,n=30;!r&&n>0;){var a=Math.floor(Math.random()*i._canvas.width),s=Math.floor(Math.random()*i._canvas.height);if(t[e].x=a,t[e].y=s,i._textBitmapper.intersects(t[e],i._bitmap))n--;else{r=!0;for(var a=t[e].x;a<t[e].x+t[e].width;a++)for(var s=t[e].y;s<t[e].y+t[e].height;s++)i._bitmap[a][s]=!0;t[e].y+=t[e].height}}r||(t[e].x=-1,t[e].y=-1)}),t}}),i.exports=a},{"./textbitmap":3,"./util":4}],2:[function(t,i,e){var r=t("./util"),n=t("./layout"),a=function(t){this._words={},this._stopWords={},this._canvas,this._width,this._height,this._backgroundFill,this._layout,r.extend(this,t)};a.prototype=r.extend(a.prototype,{canvas:function(t){return t?(this._canvas=t,this._width=t.width,this._height=t.height,this):this._canvas},width:function(t){return t?(this._canvas&&(this._canvas.width=t,this._width=t),this):this.width},height:function(t){return t?(this._canvas&&(this._canvas.height=t,this._height=t),this):this._height},text:function(t){var i=t.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"");i=i.replace(/\[[0-9]*\]/g,""),i=i.replace(/[\t+\[\]]/g,"");var e=i.split(" ");return this.words(e),this},stop:function(t){if(t){var i=this;return t.forEach(function(t){i._stopWords[t.trim().toLowerCase()]=!0}),this}return this._stopWords},background:function(t){return t?(this._backgroundFill=t,this):this._backgroundFill},words:function(t){if(t){var i=this;return t.forEach(function(t){var e=t.trim().toLowerCase();if(!i._stopWords[e]&&""!==e){var r=i._words[e];r||(r=0),r++,i._words[e]=r}}),this}return this._words},generate:function(){var t=(new n).canvas(this._canvas).words(this._words),i=t.layout(),e=this._canvas.getContext("2d");return this._backgroundFill&&(e.fillStyle=this._backgroundFill,e.fillRect(0,0,this._width,this._height)),Object.keys(i).forEach(function(t){var r=i[t];-1!==r.x&&-1!==r.y&&(e.font=r.fontSize+"px "+r.fontFamily,e.fillStyle="red",e.strokeStyle="green",e.fillText(t,r.x,r.y))}),this}}),e.Extend=r.extend,e.WordCloud=a},{"./layout":1,"./util":4}],3:[function(t,i){function e(t){var i=new Array(t||0),r=t;if(arguments.length>1)for(var n=Array.prototype.slice.call(arguments,1);r--;)i[t-1-r]=e.apply(this,n);return i}var r=t("./util"),n=function(t){this._canvas,this._context,r.extend(this,t),this._canvas=document.createElement("canvas"),this._canvas.width=640,this._canvas.height=480,this._context=this._canvas.getContext("2d"),this._bitmap=e(this._canvas.width,this._canvas.height);for(var i=0;i<this._canvas.width;i++)for(var n=0;n<this._canvas.height;n++)this._bitmap[i][n]=!1};n.prototype=r.extend(n.prototype,{create:function(t,i,r){var n=this._context;n.fillStyle="black",n.fillRect(0,0,this._canvas.width,this._canvas.height);var a=5;n.fillStyle="white",n.font=i+"px "+r,n.fillText(t,a,this._canvas.height/2);for(var s=n.measureText(t).width,h=a,o=this._canvas.height/2-i-2,c=h+s+a,u=o+i+.5*i,f=n.getImageData(h,o,c-h,u-o),d=e(f.width,f.height),l=0,_=0,v=0;v<f.data.length;v+=4)d[l][_]=0!==f.data[v],l++,l===f.width&&(l=0,_++);for(var p=Number.MAX_VALUE,g=Number.MAX_VALUE,w=-Number.MAX_VALUE,m=-Number.MAX_VALUE,l=0;l<d.length;l++)for(var _=0;_<d[l].length;_++)d[l][_]&&(p=Math.min(p,l),g=Math.min(g,_),w=Math.max(w,l),m=Math.max(m,_));for(var x=e(w-p,m-g),l=0;w-p>l;l++)for(var _=0;m-g>_;_++)x[l][_]=d[p+l][g+_];var y={width:w-p,height:m-g,bitmap:x,fontSize:i,fontFamily:r};return y},intersects:function(t,i){if(t.x+t.width>i.length)return!0;if(t.y+t.height>i[0].length)return!0;for(var e=!0,r=0;r<t.bitmap.length&&e;r++)for(var n=0;n<t.bitmap[r].length&&e;n++){var a=t.x+r,s=t.y+n,h=t.bitmap[r][n],o=i[a][s];e&=!(h&&o)}return!e},toCanvas:function(t){var i=document.createElement("canvas"),e=i.getContext("2d"),r=t.length,n=t[0].length;i.width=r,i.height=n;for(var a=e.createImageData(i.width,i.height),s=[],h=0;r>h;h++)for(var o=0;n>o;o++){var c=t[h][o]?[255,255,255,1]:[0,0,0,1];s.concat(c)}return a.data=s,e.putImageData(a,0,0),i}}),i.exports=n},{"./util":4}],4:[function(t,i){var e={extend:function(t){var i,e,r;for(e=1;e<arguments.length;e++){r=arguments[e];for(i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t},lerp:function(t,i,e){return t+e*(i-t)},step:function(t,i,e){return Math.round(this.lerp(t,i,e))}};i.exports=e},{}]},{},[2])(2)});