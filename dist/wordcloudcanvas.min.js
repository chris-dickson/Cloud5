!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.WordCloudCanvas=t()}}(function(){return function t(i,n,e){function r(s,a){if(!n[s]){if(!i[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var f=n[s]={exports:{}};i[s][0].call(f.exports,function(t){var n=i[s][1][t];return r(n?n:t)},f,f.exports,t,i,n,e)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<e.length;s++)r(e[s]);return r}({1:[function(t,i){function n(t){var i=new Array(t||0),e=t;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);e--;)i[t-1-e]=n.apply(this,r);return i}var e=t("./util"),r=t("./textbitmap"),o=function(t){this._canvas=null,this._words=null,this._bitmap=null,this._textBitmapper=null,e.extend(this,t)};o.prototype=e.extend(o.prototype,{_initialize:function(){var t={};this.debug&&(t.debug=!0),this._textBitmapper=new r(t),this._bitmap=n(this._canvas.width,this._canvas.height);for(var i=0;i<this._canvas.width;i++)for(var e=0;e<this._canvas.height;e++)this._bitmap[i][e]=!1},canvas:function(t){return t?(this._canvas=t,this):this._canvas},words:function(t){return t?(this._words=t,this):this._words},bitmap:function(){return this._textBitmapper.toCanvas(this._bitmap)},onWordOver:function(t){return this._onWordOver=t,this},onWordOut:function(t){return this._onWordOut=t,this},layout:function(){function t(t,i,e){t.fillStyle="white",t.fillRect(0,0,i,e),Object.keys(n).forEach(function(i){var e=n[i];void 0!==e.x&&-1!==e.x&&void 0!==e.y&&-1!==e.y&&(t.font=e.fontSize+"px "+e.fontFamily,t.fillStyle="red",t.strokeStyle="green",t.fillText(i,e.x,e.y),t.strokeRect(e.x+e.bb.offsetX,e.y+e.bb.offsetY,e.bb.width,e.bb.height))})}function i(t){var i=t.offsetX,n=t.offsetY,e=r._bitmap[i][n];e?(r._onWordOver&&r._onWordOver(e),u=e):u&&(r._onWordOut&&r._onWordOut(u),u=null)}this._initialize();var n={};if(this._words){var r=this,o=Number.MAX_VALUE,s=0;Object.keys(this._words).forEach(function(t){o=Math.min(r._words[t],o),s=Math.max(r._words[t],s)});var a=this.minFontSize||10,h=this.maxFontSize||200;Object.keys(this._words).forEach(function(t){var i=(r._words[t]-o)/(s-o),f=e.step(a,h,i),u=r._textBitmapper.create(t,f,r.font||"Calibri");n[t]=u,n[t].count=r._words[t],n[t].minCount=o,n[t].maxCount=s})}var f=Object.keys(this._words).sort(function(t,i){return r._words[i]-r._words[t]});f.forEach(function(i){var e=!1,o=100;for(this.debug&&t(r._canvas.getContext("2d"),r._canvas.width,r._canvas.height);!e&&o>0;){var s=Math.floor(Math.random()*r._canvas.width),a=Math.floor(Math.random()*r._canvas.height);if(n[i].x=s,n[i].y=a,r._textBitmapper.fits(n[i],r._bitmap)){e=!0;for(var h=n[i].bitmap.length,f=n[i].bitmap[0].length,u=0;h>u;u++)for(var c=0;f>c;c++){var l=n[i].x+n[i].bb.offsetX+u,_=n[i].y+n[i].bb.offsetY+c;n[i].bitmap[u][c]&&(r._bitmap[l][_]=i)}}else o--}e||(n[i].x=-1,n[i].y=-1)});var u=null;return this._canvas.onmousemove=i,n}}),i.exports=o},{"./textbitmap":3,"./util":4}],2:[function(t,i){var n=t("./util"),e=t("./layout"),r=function(t){this._words={},this._stopWords={},this._canvas=null,this._width=null,this._height=null,this._backgroundFill=null,this._onWordOver=null,this._layout=null,n.extend(this,t)};r.prototype=n.extend(r.prototype,{canvas:function(t){return t?(this._canvas=t,this._width=t.width,this._height=t.height,this):this._canvas},width:function(t){return t?(this._canvas&&(this._canvas.width=t,this._width=t),this):this.width},height:function(t){return t?(this._canvas&&(this._canvas.height=t,this._height=t),this):this._height},text:function(t){var i=t.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"");i=i.replace(/\[[0-9]*\]/g,""),i=i.replace(/[\t+\[\]]/g,"");var n=i.split(" ");return this.words(n),this},stop:function(t){if(t){var i=this;return t.forEach(function(t){i._stopWords[t.trim().toLowerCase()]=!0}),this}return this._stopWords},background:function(t){return t?(this._backgroundFill=t,this):this._backgroundFill},words:function(t){if(t){var i=this;return t.forEach(function(t){var n=t.trim().toLowerCase();if(!i._stopWords[n]&&""!==n){var e=i._words[n];e||(e=0),e++,i._words[n]=e}}),this}return this._words},onWordOver:function(t){return this._onWordOver=t,this},onWordOut:function(t){return this._onWordOut=t,this},font:function(t){return t?(this._font=t,this):this._font},minFontSize:function(t){return t?(this._minFontSize=t,this):this._minFontSize},maxFontSize:function(t){return t?(this._maxFontSize=t,this):this._maxFontSize},color:function(t){return t?(this._color=t,this):this._color},generate:function(){var t={};this.debug&&(t.debug=!0),this._font&&(t.font=this._font),this._minFontSize&&(t.minFontSize=this._minFontSize),this._maxFontSize&&(t.maxFontSize=this._maxFontSize),this._layout=new e(t).canvas(this._canvas).words(this._words).onWordOver(this._onWordOver).onWordOut(this._onWordOut);var i=this._layout.layout(),n=this._canvas.getContext("2d");n.fillStyle=this._backgroundFill||"white",n.fillRect(0,0,this._width,this._height);var r=this;return Object.keys(i).forEach(function(t){var e=i[t];if(-1!==e.x&&-1!==e.y){n.font=e.fontSize+"px "+e.fontFamily;var o="black";if(r._color)if(r._color instanceof Array){var s=Math.floor(Math.random()*r._color.length);o=r._color[s]}else o=r._color instanceof Function?r._color(i[t]):r._color;n.fillStyle=o,n.fillText(t,e.x,e.y),r.debug&&(n.strokeStyle="green",n.strokeRect(e.x+e.bb.offsetX,e.y+e.bb.offsetY,e.bb.width,e.bb.height))}}),this}}),i.exports=r},{"./layout":1,"./util":4}],3:[function(t,i){function n(t){var i=new Array(t||0),e=t;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);e--;)i[t-1-e]=n.apply(this,r);return i}var e=t("./util"),r=function(t){this._canvas=null,this._context=null,e.extend(this,t),this._canvas=document.createElement("canvas"),this._canvas.width=640,this._canvas.height=480,this._context=this._canvas.getContext("2d"),this.debug&&document.body.appendChild(this._canvas),this._bitmap=n(this._canvas.width,this._canvas.height);for(var i=0;i<this._canvas.width;i++)for(var r=0;r<this._canvas.height;r++)this._bitmap[i][r]=!1};r.prototype=e.extend(r.prototype,{create:function(t,i,e){var r=this._context;r.fillStyle="black",r.fillRect(0,0,this._canvas.width,this._canvas.height);var o=5,s=Math.floor(this._canvas.height/2);r.fillStyle="white",r.font=i+"px "+e,r.fillText(t,o,s);for(var a=r.measureText(t).width,h=o,f=s-i-2,u=h+a+o,c=f+i+.5*i,l=r.getImageData(h,f,u-h,c-f),_=n(l.width,l.height),d=0,v=0,p=0;p<l.data.length;p+=4)_[d][v]=0!==l.data[p],d++,d===l.width&&(d=0,v++);var b=Number.MAX_VALUE,m=Number.MAX_VALUE,g=-Number.MAX_VALUE,w=-Number.MAX_VALUE;for(d=0;d<_.length;d++)for(v=0;v<_[d].length;v++)_[d][v]&&(b=Math.min(b,d),m=Math.min(m,v),g=Math.max(g,d),w=Math.max(w,v));var y=n(g-b,w-m);for(d=0;g-b>d;d++)for(v=0;w-m>v;v++)y[d][v]=_[b+d][m+v];this.debug&&(r.strokeStyle="yellow",r.strokeRect(h,f,u-h,c-f)),r.strokeStyle="red",r.strokeRect(o,s,this._canvas.width,this._canvas.height);var x=g-b,S=w-m,O=-(o-(h+b)),k=-(s-(f+m));this.debug&&(r.strokeStyle="green",r.strokeRect(o+O,s+k,x,S));var F={bb:{offsetX:O,offsetY:k,width:x,height:S},bitmap:y,fontSize:i,fontFamily:e};return F},fits:function(t,i){for(var n=t.x+t.bb.offsetX,e=t.y+t.bb.offsetY,r=i.length,o=i[0].length,s=0>n||0>e,a=!1,h=s||a,f=0;f<t.bb.width&&!h;f++)for(var u=n+f,c=0;c<t.bb.height&&!h;c++){var l=e+c;u>=r||l>=o?s=!0:i[u][l]&&(a=!0),h=s||a}return!h}}),i.exports=r},{"./util":4}],4:[function(t,i){var n={extend:function(t){var i,n,e;for(n=1;n<arguments.length;n++){e=arguments[n];for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}return t},lerp:function(t,i,n){return t+n*(i-t)},step:function(t,i,n){return Math.round(this.lerp(t,i,n))}};i.exports=n},{}]},{},[2])(2)});